<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.dao.BaseMapper">
	<resultMap id="UserMap" type="com.dto.UserDto"></resultMap>
	<resultMap id="HislogMap" type="com.dto.HislogDto"></resultMap>
	
	<resultMap id="FormModel" 
	    type="com.form.FormModel"></resultMap>  

	<!-- 根据用户名和密码获取用户信息-->
	<select id="getUser" resultMap="UserMap" parameterType="com.dto.UserDto">
		select * from users where userName = #{userName} and userPassword = #{userPassword}
	</select>
	
	<!-- 修改密码 -->
	<update id="updatePWD" parameterType="com.dto.UserDto">
		update users set userName = #{userName},userPassword = #{userPassword}, updateDate = NOW() where id = #{id}
	</update>
	
	<select id="getUserList" resultMap="UserMap"
		parameterType="java.util.Map">
		select t1.*,t2.name as healthName from users t1 LEFT JOIN healthcenters t2 on t1.hcid = t2.id where 1=1
		<if test="name!='' and name!=null">
			and t1.userName like concat('%',#{name},'%')
		</if>
		limit #{start},#{limit}
	</select>

	<select id="getUserListCount" resultType="Integer"
		parameterType="java.util.Map">
		select count(1) from users where 1=1
		<if test="name!='' and name!=null">
			and userName like concat('%',#{name},'%')
		</if>
	</select>
	
	<insert id="insertUser"
		parameterType="com.dto.UserDto">
		INSERT INTO users(userName,userPassword,province,city,district,hcid,createDate,updateDate)
		VALUES(#{userName},#{userPassword},#{province},#{city},#{district},#{hcid},NOW(),NOW())
	</insert>
	
	<update id="updUser"
		parameterType="com.dto.UserDto">
		update users set userName = #{userName},userPassword=#{userPassword},
		province=#{province},city=#{city},district=#{district},
		hcid=#{hcid},updateDate=NOW()
		where id = #{id}
	</update>
	
	<select id="getUserCount" resultType="Integer"
		parameterType="java.util.Map">
		select count(1) from users where userName = #{name}
	</select>
	
	<select id="getSynData" resultMap="FormModel"
		parameterType="java.util.Map">
			SELECT t1.idcard as field1,
				   DATE_FORMAT(t1.filedate,"%Y-%m-%d") as field2,
				   t1.name as field3,
				   t1.sex as field4,
				   t1.marital as field5,
				   t1.career as field6,
				   t1.rtype as field7,
				   t1.elevel as field8,
				   t1.cname as field9,
				   DATE_FORMAT(t1.birthdate,"%Y-%m-%d") as field10,
				   t1.phoneno as field11,
				   t1.cphoneno as field12,
				   t1.blood as field13,
				   t1.RH as field14,
				   t1.paymentway as field15,
				   t1.field4 as field16,
				   t1.allergy as field17,
				   t1.exposure as field18,
				   t1.disability as field19,
				   t1.kfacility as field20,
				   t1.ftype as field21,
				   t1.dwater as field22,
				   t1.toilet as field23,
				   t1.poultry as field24,
				   DATE_FORMAT(t2.field1,"%Y-%m-%d") as field25,
				   t2.field2 as field26,
				   CONCAT(t2.field209,'，',t2.field211,'，',t2.field212,'，',t2.field213) as field27,
				   t2.field214 as field28,
				   t2.field215 as field29,
				   t2.field216 as field30,
				   t2.field217 as field31,
				   t2.field218 as field32,
				   t2.field4 as field33,
				   t2.field5 as field34,
				   t2.field77 as field35,
				   t2.field6 as field36,
				   t2.field7 as field37,
				   t2.field8 as field38,
				   t2.field9 as field39,
				   t2.field10 as field40,
				   t2.field11 as field41,
				   t2.field12 as field42,
				   t2.field13 as field43,
				   t2.field219 as field44,
				   t2.field86 as field45,
				   t2.field49 as field46,
				   t2.field50 as field47,
				   CONCAT(t2.field51,'，',t2.field52,'，',t2.field53,'，',t2.field54) as field48,
				   CONCAT(t2.field55,'，',t2.field56,'，',t2.field57,'，',t2.field58) as field49,
				   CONCAT(t2.field59,'，',t2.field60,'，',t2.field61,'，',t2.field62) as field50,
				   t2.field63 as field51,
				   t2.field64 as field52,
				   t2.field65 as field53,
				   t2.field66 as field54,
				   t2.field67 as field55,
				   t2.field68 as field56,
				   t2.field69 as field57,
				   t2.field70 as field58,
				   t2.field71 as field59,
				   t2.field72 as field60,
				   t2.field73 as field61,
				   t2.field74 as field62,
				   t2.field75 as field63,
				   t2.field76 as field64,
				   t2.field78 as field65,
				   t2.field79 as field66,
				   t2.field80 as field67,
				   t2.field81 as field68,
				   t2.field82 as field69,
				   t2.field83 as field70,
				   t2.field84 as field71,
				   t2.field85 as field72,
				   t2.field87 as field73,
				   t2.field88 as field74,
				   t2.field106 as field75,
				   t2.field97 as field76,
				   t2.field98 as field77,
				   t2.field99 as field78,
				   t2.field100 as field79,
				   t2.field101 as field80,
				   t2.field102 as field81,
				   t2.field103 as field82,
				   t2.field104 as field83,
				   t2.field105 as field84,
				   t2.field109 as field85,
				   t2.field110 as field86,
				   t2.field114 as field87,
				   t2.field115 as field88,
				   t2.field116 as field89,
				   t2.field117 as field90,
				   t2.field118 as field91,
				   t2.field119 as field92,
				   t2.field120 as field93,
				   t2.field121 as field94,
				   t2.field123 as field96,
				   t2.field124 as field97,
				   t2.field125 as field98,
				   t2.field126 as field99,
				   t2.field111 as field100,
				   t2.field127 as field101,
				   t2.field128 as field95,
				   t2.field129 as field102,
				   t2.field130 as field103,
				   t2.field245 as field110,
				   t2.field222 as field104,
				   t2.field98 as field105,
				   t2.field241 as field107,
				   t2.field242 as field108,
				   t2.field169 as field109,
				   t2.field170 as field106,
				   t2.field171 as field111,
				   t2.field172 as field112,
				   t2.field173 as field113,
				   t2.field174 as field114,
				   t2.field175 as field115,
				   t2.field176 as field116,
				   t2.field177 as field117,
				   t2.field178 as field118,
				   t2.field179 as field119,
				   t2.field180 as field120,
				   t2.field181 as field121,
				   t2.field182 as field122,
				   t2.field183 as field123,
				   t2.field184 as field124,
				   t2.field185 as field125,
				   t2.field186 as field126,
				   t2.field187 as field127,
				   t2.field188 as field128,
				   t2.field189 as field129,
				   t2.field190 as field130,
				   t2.field191 as field131,
				   t2.field192 as field132,
				   t2.field193 as field133,
				   t2.field194 as field134,
				   t2.field195 as field135,
				   t2.field196 as field136,
				   t2.field197 as field137,
				   t2.field198 as field138,
				   DATE_FORMAT(t2.field149,"%Y-%m-%d") as field139,
				   DATE_FORMAT(t2.field150,"%Y-%m-%d") as field140,
				   t2.field153 as field141,
				   t2.field155 as field142,
				   t2.field157 as field143,
				   DATE_FORMAT(t2.field151,"%Y-%m-%d") as field144,
				   DATE_FORMAT(t2.field152,"%Y-%m-%d") as field145,
				   t2.field154 as field146,
				   t2.field156 as field147,
				   t2.field158 as field148,
				   t2.field19 as field149,
				   t2.field20 as field150,
				   t2.field21 as field151,
				   t2.field22 as field152,
				   t2.field23 as field153,
				   t2.field24 as field154,
				   t2.field25 as field155,
				   t2.field26 as field156,
				   t2.field27 as field157,
				   t2.field28 as field158,
				   t2.field29 as field159,
				   t2.field30 as field160,
				   t2.field31 as field161,
				   t2.field32 as field162,
				   t2.field33 as field163,
				   t2.field34 as field164,
				   t2.field36 as field165,
				   t2.field37 as field166,
				   t2.field38 as field167,
				   t2.field137 as field168,
				   t2.field139 as field169,
				   t2.field141 as field170,
				   t2.field143 as field171,
				   t2.field145 as field172,
				   t2.field147 as field173,
				   t2.field15 as field174,
				   t2.field17 as field175,
				   t2.field18 as field176,
				   t3.field6 as field177,
				   t4.field34 as field178,
				   t4.field35 as field179,
				   t4.field36 as field180,
				   t4.field37 as field181,
				   t4.field38 as field182,
				   t4.field39 as field183,
				   t4.field40 as field184,
				   t4.field41 as field185,
				   t4.field42 as field186,
				   t4.field1 as field187,
				   t4.field2 as field188,
				   t4.field3 as field189,
				   t4.field4 as field190,
				   t4.field5 as field191,
				   t4.field6 as field192,
				   t4.field7 as field193,
				   t4.field8 as field194,
				   t4.field9 as field195,
				   t4.field10 as field196,
				   t4.field11 as field197,
				   t4.field12 as field198,
				   t4.field13 as field199,
				   t4.field14 as field200,
				   t4.field15 as field201,
				   t4.field16 as field202,
				   t4.field17 as field203,
				   t4.field18 as field204,
				   t4.field19 as field205,
				   t4.field20 as field206,
				   t4.field21 as field207,
				   t4.field22 as field208,
				   t4.field23 as field209,
				   t4.field24 as field210,
				   t4.field25 as field211,
				   t4.field26 as field212,
				   t4.field27 as field213,
				   t4.field28 as field214,
				   t4.field29 as field215,
				   t4.field30 as field216,
				   t4.field31 as field217,
				   t4.field32 as field218,
				   t4.field33 as field219,
				   t2.field3 as field220,
				   t2.field138 as field221,
				   t2.field140 as field222,
				   t2.field142 as field223,
				   t2.field144 as field224,
				   t2.field146 as field225,
				   t2.field148 as field226,
				   t2.field35 as field227,
				   t4.field34 as field228,
				   t4.field35 as field229,
				   t4.field36 as field230,
				   t4.field37 as field231,
				   t4.field38 as field232,
				   t4.field39 as field233,
				   t4.field40 as field234,
				   t4.field41 as field235,
				   t4.field42 as field236,
				   t1.code as field237,
				   t4.field53 as field238,
   				   t4.field54 as field239,
   				   t4.field55 as field240,
   			       t4.field56 as field241,
    			   t4.field57 as field242,
    			   t4.field58 as field243,
    			   t4.field59 as field244,
    			   t4.field60 as field245,
    			   t4.field61 as field246,
    			   t2.field132 as field247,
				   t2.field133 as field248,
				   t2.field16 as field249,
				   t2.field89 as field250,
				   t2.field90 as field251,
				   t2.field91 as field252,
				   t2.field92 as field253,
				   t2.field93 as field254,
				   t2.field94 as field255,
				   t2.field131 as field256,
                   t2.field220 as field257,
	               t2.field221 as field258,
	               t2.field256 as field259,
	               t2.field257 as field260,
	               t2.field268 as field261,
	               t2.field269 as field262,
	               t1.id as field263,
	               t1.mtid as field264
					from patients t1
			LEFT JOIN healthcheckup t2 ON t1.id = t2.pid
			LEFT JOIN selfcare t3 on t1.id = t3.pid
			LEFT JOIN TCM t4 ON t1.id = t4.pid
	     WHERE t1.hcid = #{hid}
	      <if test="idCard!='' and idCard!=null">
			AND t1.idcard = #{idCard}
		  </if>
	      AND t2.field1 >= STR_TO_DATE(#{startDate},'%Y-%m-%d %H:%i:%s')
	      <![CDATA[
	      AND t2.field1 <= STR_TO_DATE(#{endDate},'%Y-%m-%d %H:%i:%s')
	      ]]>
	</select>
	
	
	<select id="uploadSynData" resultMap="FormModel"
		parameterType="java.util.Map">
			SELECT t1.idcard as field1,
				   DATE_FORMAT(t1.filedate,"%Y-%m-%d") as field2,
				   t1.name as field3,
				   t1.sex as field4,
				   t1.marital as field5,
				   t1.career as field6,
				   t1.rtype as field7,
				   t1.elevel as field8,
				   t1.cname as field9,
				   DATE_FORMAT(t1.birthdate,"%Y-%m-%d") as field10,
				   t1.phoneno as field11,
				   t1.cphoneno as field12,
				   t1.blood as field13,
				   t1.RH as field14,
				   t1.paymentway as field15,
				   t1.field4 as field16,
				   t1.allergy as field17,
				   t1.exposure as field18,
				   t1.disability as field19,
				   t1.kfacility as field20,
				   t1.ftype as field21,
				   t1.dwater as field22,
				   t1.toilet as field23,
				   t1.poultry as field24,
				   DATE_FORMAT(t2.field1,"%Y-%m-%d") as field25,
				   t2.field2 as field26,
				   CONCAT(t2.field209,'，',t2.field211,'，',t2.field212,'，',t2.field213) as field27,
				   t2.field214 as field28,
				   t2.field215 as field29,
				   t2.field216 as field30,
				   t2.field217 as field31,
				   t2.field218 as field32,
				   t2.field4 as field33,
				   t2.field5 as field34,
				   t2.field77 as field35,
				   t2.field6 as field36,
				   t2.field7 as field37,
				   t2.field8 as field38,
				   t2.field9 as field39,
				   t2.field10 as field40,
				   t2.field11 as field41,
				   t2.field12 as field42,
				   t2.field13 as field43,
				   t2.field219 as field44,
				   t2.field86 as field45,
				   t2.field49 as field46,
				   t2.field50 as field47,
				   CONCAT(t2.field51,'，',t2.field52,'，',t2.field53,'，',t2.field54) as field48,
				   CONCAT(t2.field55,'，',t2.field56,'，',t2.field57,'，',t2.field58) as field49,
				   CONCAT(t2.field59,'，',t2.field60,'，',t2.field61,'，',t2.field62) as field50,
				   t2.field63 as field51,
				   t2.field64 as field52,
				   t2.field65 as field53,
				   t2.field66 as field54,
				   t2.field67 as field55,
				   t2.field68 as field56,
				   t2.field69 as field57,
				   t2.field70 as field58,
				   t2.field71 as field59,
				   t2.field72 as field60,
				   t2.field73 as field61,
				   t2.field74 as field62,
				   t2.field75 as field63,
				   t2.field76 as field64,
				   t2.field78 as field65,
				   t2.field79 as field66,
				   t2.field80 as field67,
				   t2.field81 as field68,
				   t2.field82 as field69,
				   t2.field83 as field70,
				   t2.field84 as field71,
				   t2.field85 as field72,
				   t2.field87 as field73,
				   t2.field88 as field74,
				   t2.field106 as field75,
				   t2.field97 as field76,
				   t2.field98 as field77,
				   t2.field99 as field78,
				   t2.field100 as field79,
				   t2.field101 as field80,
				   t2.field102 as field81,
				   t2.field103 as field82,
				   t2.field104 as field83,
				   t2.field105 as field84,
				   t2.field109 as field85,
				   t2.field110 as field86,
				   t2.field114 as field87,
				   t2.field115 as field88,
				   t2.field116 as field89,
				   t2.field117 as field90,
				   t2.field118 as field91,
				   t2.field119 as field92,
				   t2.field120 as field93,
				   t2.field121 as field94,
				   t2.field123 as field96,
				   t2.field124 as field97,
				   t2.field125 as field98,
				   t2.field126 as field99,
				   t2.field111 as field100,
				   t2.field127 as field101,
				   t2.field128 as field95,
				   t2.field129 as field102,
				   t2.field130 as field103,
				   t2.field245 as field110,
				   t2.field222 as field104,
				   t2.field98 as field105,
				   t2.field241 as field107,
				   t2.field242 as field108,
				   t2.field169 as field109,
				   t2.field170 as field106,
				   t2.field171 as field111,
				   t2.field172 as field112,
				   t2.field173 as field113,
				   t2.field174 as field114,
				   t2.field175 as field115,
				   t2.field176 as field116,
				   t2.field177 as field117,
				   t2.field178 as field118,
				   t2.field179 as field119,
				   t2.field180 as field120,
				   t2.field181 as field121,
				   t2.field182 as field122,
				   t2.field183 as field123,
				   t2.field184 as field124,
				   t2.field185 as field125,
				   t2.field186 as field126,
				   t2.field187 as field127,
				   t2.field188 as field128,
				   t2.field189 as field129,
				   t2.field190 as field130,
				   t2.field191 as field131,
				   t2.field192 as field132,
				   t2.field193 as field133,
				   t2.field194 as field134,
				   t2.field195 as field135,
				   t2.field196 as field136,
				   t2.field197 as field137,
				   t2.field198 as field138,
				   DATE_FORMAT(t2.field149,"%Y-%m-%d") as field139,
				   DATE_FORMAT(t2.field150,"%Y-%m-%d") as field140,
				   t2.field153 as field141,
				   t2.field155 as field142,
				   t2.field157 as field143,
				   DATE_FORMAT(t2.field151,"%Y-%m-%d") as field144,
				   DATE_FORMAT(t2.field152,"%Y-%m-%d") as field145,
				   t2.field154 as field146,
				   t2.field156 as field147,
				   t2.field158 as field148,
				   t2.field19 as field149,
				   t2.field20 as field150,
				   t2.field21 as field151,
				   t2.field22 as field152,
				   t2.field23 as field153,
				   t2.field24 as field154,
				   t2.field25 as field155,
				   t2.field26 as field156,
				   t2.field27 as field157,
				   t2.field28 as field158,
				   t2.field29 as field159,
				   t2.field30 as field160,
				   t2.field31 as field161,
				   t2.field32 as field162,
				   t2.field33 as field163,
				   t2.field34 as field164,
				   t2.field36 as field165,
				   t2.field37 as field166,
				   t2.field38 as field167,
				   t2.field137 as field168,
				   t2.field139 as field169,
				   t2.field141 as field170,
				   t2.field143 as field171,
				   t2.field145 as field172,
				   t2.field147 as field173,
				   t2.field15 as field174,
				   t2.field17 as field175,
				   t2.field18 as field176,
				   t3.field6 as field177,
				   t4.field34 as field178,
				   t4.field35 as field179,
				   t4.field36 as field180,
				   t4.field37 as field181,
				   t4.field38 as field182,
				   t4.field39 as field183,
				   t4.field40 as field184,
				   t4.field41 as field185,
				   t4.field42 as field186,
				   t4.field1 as field187,
				   t4.field2 as field188,
				   t4.field3 as field189,
				   t4.field4 as field190,
				   t4.field5 as field191,
				   t4.field6 as field192,
				   t4.field7 as field193,
				   t4.field8 as field194,
				   t4.field9 as field195,
				   t4.field10 as field196,
				   t4.field11 as field197,
				   t4.field12 as field198,
				   t4.field13 as field199,
				   t4.field14 as field200,
				   t4.field15 as field201,
				   t4.field16 as field202,
				   t4.field17 as field203,
				   t4.field18 as field204,
				   t4.field19 as field205,
				   t4.field20 as field206,
				   t4.field21 as field207,
				   t4.field22 as field208,
				   t4.field23 as field209,
				   t4.field24 as field210,
				   t4.field25 as field211,
				   t4.field26 as field212,
				   t4.field27 as field213,
				   t4.field28 as field214,
				   t4.field29 as field215,
				   t4.field30 as field216,
				   t4.field31 as field217,
				   t4.field32 as field218,
				   t4.field33 as field219,
				   t2.field3 as field220,
				   t2.field138 as field221,
				   t2.field140 as field222,
				   t2.field142 as field223,
				   t2.field144 as field224,
				   t2.field146 as field225,
				   t2.field148 as field226,
				   t2.field35 as field227,
				   t4.field34 as field228,
				   t4.field35 as field229,
				   t4.field36 as field230,
				   t4.field37 as field231,
				   t4.field38 as field232,
				   t4.field39 as field233,
				   t4.field40 as field234,
				   t4.field41 as field235,
				   t4.field42 as field236,
				   t1.code as field237,
				   t4.field53 as field238,
   				   t4.field54 as field239,
   				   t4.field55 as field240,
   			       t4.field56 as field241,
    			   t4.field57 as field242,
    			   t4.field58 as field243,
    			   t4.field59 as field244,
    			   t4.field60 as field245,
    			   t4.field61 as field246,
    			   t2.field132 as field247,
				   t2.field133 as field248,
				   t2.field16 as field249,
				   t2.field89 as field250,
				   t2.field90 as field251,
				   t2.field91 as field252,
				   t2.field92 as field253,
				   t2.field93 as field254,
				   t2.field94 as field255,
				   t2.field131 as field256,
                   t2.field220 as field257,
	               t2.field221 as field258,
	               t2.field256 as field259,
	               t2.field257 as field260,
	               t2.field268 as field261,
	               t2.field269 as field262,
	               t1.id as field263,
	               t1.mtid as field264
					from patients t1
			LEFT JOIN healthcheckup t2 ON t1.id = t2.pid
			LEFT JOIN selfcare t3 on t1.id = t3.pid
			LEFT JOIN TCM t4 ON t1.id = t4.pid
	     WHERE t1.code in (${codes})
	</select>
	
	<insert id="insertHislog"
		parameterType="com.dto.HislogDto">
		INSERT INTO hislog(hcid,regionid,regioncode,dcode,dname,sucnum,errnum,erromsg,createDate,updateDate)
		VALUES(#{hcid},#{regionid},#{regioncode},#{dcode},#{dname},#{sucnum},#{errnum},#{erromsg},NOW(),NOW())
	</insert>
	
	<!-- 获取异常信息-->
	<select id="getHislog" resultMap="HislogMap" parameterType="java.util.Map">
		<![CDATA[
			select * from hislog where erromsg <> ''
		]]>
		<if test="hcid!='' and hcid!=null">
			AND hcid = #{hcid}
		</if>
	</select>
	
	<!-- 修改密码 -->
	<update id="updateHislog" parameterType="com.dto.HislogDto">
		update hislog set sucnum = #{sucnum},errnum = #{errnum},erromsg=#{erromsg},updateDate=NOW() where id = #{id}
	</update>
	
	<!-- 获取各个卫生院体检数据 -->
	<select id="getCData" resultMap="FormModel"
		parameterType="java.util.Map">
		<![CDATA[
		SELECT t1.pname as field1,t2.name as field2,COUNT(*) as field3 FROM areas t1 
		LEFT JOIN healthcenters t2 ON t1.code = t2.district 
		LEFT JOIN patients t3 ON t2.id = t3.hcid 
		LEFT JOIN healthcheckup t4 ON t4.pid = t3.id
		WHERE t4.field1 >= STR_TO_DATE(#{startDate},'%Y-%m-%d %H:%i:%s')
	    AND t4.field1 <= STR_TO_DATE(#{endDate},'%Y-%m-%d %H:%i:%s')
		GROUP BY t1.pname,t2.name
		]]>
	</select>
</mapper>